(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[559],{68288:function(d,b,c){"use strict";c.d(b,{"$f":function(){return a},AF:function(){return e},Ft:function(){return h},ao:function(){return f},dL:function(){return g}});var e="StoryForm-dev",a={goerli:"0xB8F8D1AD7A8D8161223AC1276D8a361faC2534f9",hardhat:"0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9"},f=1,g={goerli:{name:"StoryForm-dev",version:"1",chainId:"5",verifyingContract:a.goerli},hardhat:{name:"StoryForm-dev",version:"1",chainId:"31337",verifyingContract:a.hardhat}},h={Question:[{name:"label",type:"string"},{name:"type",type:"string"}],Form:[{name:"owner",type:"string"},{name:"title",type:"string"},{name:"unixTime",type:"int256"},{name:"questions",type:"Question[]"}]}},64750:function(r,d,a){"use strict";a.d(d,{cI:function(){return X},MS:function(){return $},nT:function(){return ac},D0:function(){return ae},WP:function(){return ad},kS:function(){return W},"_v":function(){return U},h0:function(){return ab},Hz:function(){return Y},"_J":function(){return aa},Wy:function(){return Z}});var b=a(47568),e=a(34051),c=a.n(e),s=a(67294),t=a(7297),f=a(9669),g=a.n(f),h=g().create({baseURL:"https://story-gateway-74zr6opnjq-an.a.run.app"}),u=h,i=a(73243),j=a(46495),k=new i.f({uri:"https://arweave.net/graphql",cache:new j.h}),v=k,l=a(47386),m=a.n(l),n=m().init({host:"arweave.net",port:443,protocol:"https"}),w=n,x=a(17283),y=a(68288),z=a(45682);function A(){var a=(0,t.Z)(["\n      query transactions($first: Int!, $after: String, $tags: [TagFilter!]) {\n        transactions(first: $first, after: $after, tags: $tags) {\n          edges {\n            node {\n              id\n              tags {\n                value\n                name\n              }\n            }\n          }\n        }\n      }\n    "]);return A=function(){return a},a}(0,b.Z)(c().mark(function a(b){var d;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u.post("/answers",b);case 2:d=a.sent;case 3:case"end":return a.stop()}},a)}));var B=(M=(0,b.Z)(c().mark(function a(d){var e,f,g,h,i,j,k;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=d.formId,f=d.first,g=d.after,h=d.storyForm,a.next=3,v.query({query:(0,x.Ps)(A()),variables:{first:f,after:g,tags:[{name:"App-Id",values:[y.AF],op:"EQ"},{name:"Type",values:["submission"],op:"EQ"},{name:"Form-Id",values:[e],op:"EQ"}]}});case 3:return i=a.sent,j=(0,z.HW)(i,"Submission-Id"),a.next=7,Promise.all(j.map(function(a){return(0,b.Z)(c().mark(function b(){var d,e,f,g,i;return c().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=1,b.next=4,w.transactions.getData(a.id,{decode:!0,string:!0});case 4:d=b.sent.toString(),b.next=11;break;case 7:b.prev=7,b.t0=b.catch(1),console.error(b.t0),d=null;case 11:return b.next=13,w.transactions.getStatus(a.id);case 13:return e=b.sent,f=(0,z.Gp)(a,"Submission-Id"),b.next=17,h.queryFilter(h.filters.ProofVerified(f,null));case 17:return i=(null==(g=b.sent)?void 0:g.length)&&g[0],b.abrupt("return",{txId:a.id,formId:(0,z.Gp)(a,"Form-Id"),answers:d&&JSON.parse(d).answers||[],submissionId:f,arweaveTxStatus:e.status,verificationTx:null==i?void 0:i.transactionHash,unixTime:parseInt((0,z.Gp)(a,"Unix-Time"))});case 20:case"end":return b.stop()}},b,null,[[1,7]])}))().catch(function(a){return a})}));case 7:return k=a.sent.filter(z.Dw).filter(z.$),a.abrupt("return",k);case 9:case"end":return a.stop()}},a)})),function(a){return M.apply(this,arguments)}),C=a(89925),D=JSON.parse('{"Mt":[{"inputs":[{"internalType":"contract IStoryFormVerifier","name":"_storyFormVerifier","type":"address"},{"internalType":"contract IVerifier","name":"_semaphoreVerifier","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"groupId","type":"uint256"},{"indexed":false,"internalType":"uint8","name":"depth","type":"uint8"},{"indexed":false,"internalType":"uint256","name":"zeroValue","type":"uint256"}],"name":"GroupCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"groupId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"identityCommitment","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"root","type":"uint256"}],"name":"MemberAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"groupId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"identityCommitment","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"root","type":"uint256"}],"name":"MemberRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"nullifierHash","type":"uint256"}],"name":"NullifierHashAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"submissionId","type":"uint256"},{"indexed":true,"internalType":"uint256","name":"groupId","type":"uint256"}],"name":"ProofVerified","type":"event"},{"inputs":[{"internalType":"uint256","name":"groupId","type":"uint256"},{"internalType":"uint256","name":"identityCommitment","type":"uint256"}],"name":"addMember","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"groupId","type":"uint256"},{"internalType":"uint8","name":"depth","type":"uint8"}],"name":"createGroup","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"groupId","type":"uint256"}],"name":"getDepth","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"groupId","type":"uint256"}],"name":"getNumberOfLeaves","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"groupId","type":"uint256"}],"name":"getRoot","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"semaphoreVerifier","outputs":[{"internalType":"contract IVerifier","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"storyFormVerifier","outputs":[{"internalType":"contract IStoryFormVerifier","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"formId","type":"uint256"},{"internalType":"uint256","name":"groupId","type":"uint256"},{"internalType":"uint256","name":"submissionId","type":"uint256"},{"internalType":"uint256[8]","name":"membershipProof","type":"uint256[8]"},{"internalType":"uint256[8]","name":"submissionOwnershipProof","type":"uint256[8]"}],"name":"veirfyProof","outputs":[],"stateMutability":"nonpayable","type":"function"}]}'),E=a(58170),F=a(3461),G=a(6427),H=a(41799),I=a(69396);function J(){var a=(0,t.Z)(["\n      query transactions($first: Int!, $after: String, $tags: [TagFilter!]) {\n        transactions(first: $first, after: $after, tags: $tags) {\n          edges {\n            node {\n              id\n              tags {\n                value\n                name\n              }\n            }\n          }\n        }\n      }\n    "]);return J=function(){return a},a}function K(){var a=(0,t.Z)(["\n      query transactions($first: Int!, $after: String, $tags: [TagFilter!]) {\n        transactions(first: $first, after: $after, tags: $tags) {\n          edges {\n            node {\n              id\n              tags {\n                value\n                name\n              }\n            }\n          }\n        }\n      }\n    "]);return K=function(){return a},a}var L,M,o,p,q,N,O=(o=(0,b.Z)(c().mark(function a(b){var d,e,f,g,h;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=3,v.query({query:(0,x.Ps)(J()),variables:{first:1,tags:[{name:"App-Id",values:[y.AF],op:"EQ"},{name:"Form-Id",values:[b],op:"EQ"},{name:"Type",values:["Form"],op:"EQ"}]}});case 3:if(g=null===(d=(f=a.sent).data.transactions.edges[0])|| void 0===d?void 0:null===(e=d.node)|| void 0===e?void 0:e.id){a.next=7;break}return a.abrupt("return",null);case 7:return a.next=9,w.transactions.getData(g,{decode:!0,string:!0});case 9:if(h=a.sent.toString()){a.next=12;break}return a.abrupt("return",null);case 12:return a.abrupt("return",(0,I.Z)((0,H.Z)({},JSON.parse(h)),{arweaveTxId:g}));case 13:case"end":return a.stop()}},a)})),function(a){return o.apply(this,arguments)}),P=(p=(0,b.Z)(c().mark(function a(d){var e,f,g,h,i;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=d.first,f=d.after,a.next=3,v.query({query:(0,x.Ps)(K()),variables:{first:e,after:f,tags:[{name:"App-Id",values:[y.AF],op:"EQ"},{name:"Type",values:["Form"],op:"EQ"}]}});case 3:return g=a.sent,h=(0,z.HW)(g,"Form-Id"),a.next=7,Promise.all(h.map(function(a){return(0,b.Z)(c().mark(function b(){var d,e;return c().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=1,b.next=4,w.transactions.getData(a.id,{decode:!0,string:!0});case 4:d=b.sent.toString(),b.next=11;break;case 7:b.prev=7,b.t0=b.catch(1),console.error(b.t0),d=null;case 11:if(d){b.next=13;break}return b.abrupt("return",null);case 13:return e=JSON.parse(d),b.abrupt("return",{id:(0,z.Gp)(a,"Form-Id"),questions:null==e?void 0:e.questions,title:null==e?void 0:e.title,owner:null==e?void 0:e.owner,unixTime:null==e?void 0:e.unixTime,arweaveTxId:a.id});case 15:case"end":return b.stop()}},b,null,[[1,7]])}))().catch(function(a){return a})}));case 7:return i=a.sent.filter(z.Dw).map(function(a){return(0,z.jL)(a)||console.log("Invalid form ".concat(JSON.stringify(a))),a}).filter(z.jL),a.abrupt("return",i);case 9:case"end":return a.stop()}},a)})),function(a){return p.apply(this,arguments)}),Q=a(52325),R=(q=(0,b.Z)(c().mark(function a(b){var d;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Q.groth16.fullProve(b,"/prove/prove.wasm","/prove/prove_1.zkey");case 2:return d=a.sent,a.abrupt("return",d);case 4:case"end":return a.stop()}},a)})),function(a){return q.apply(this,arguments)});(0,b.Z)(c().mark(function a(b){var d,e,f;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,g().get("http://localhost:3000/prove/verification_key.json");case 2:return e=(d=a.sent).data,a.next=6,Q.groth16.verify(e,b.publicSignals,b.proof);case 6:return f=a.sent,a.abrupt("return",f);case 8:case"end":return a.stop()}},a)}));var S=a(18661).generateProof,T=function(){var a=(0,C.yL)();return(0,C.cq)({addressOrName:y.$f[a.network.name],contractInterface:D.Mt,signerOrProvider:a})},U=function(f){var a=(0,s.useState)(),e=a[0],g=a[1],d=(0,C.yL)(),h=(0,C.cq)({addressOrName:y.$f[d.network.name],contractInterface:D.Mt,signerOrProvider:d});return(0,s.useEffect)(function(){(0,b.Z)(c().mark(function a(){var b,d,e;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!h){a.next=8;break}return a.next=3,h.queryFilter(h.filters.MemberAdded(f));case 3:d=(b=a.sent).map(function(a){return a.args[1].toString()}),(e=new E.Z(16)).addMembers(d),g(e);case 8:case"end":return a.stop()}},a)}))()},[]),{group:e}},V=function(){var a,d=(0,C.QW)({message:"Keep this secret safe"}).signMessageAsync;return a=(0,b.Z)(c().mark(function a(){return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=F.poseidon,a.next=3,d();case 3:return a.t1=a.sent,a.t2=[a.t1],a.abrupt("return",(0,a.t0)(a.t2));case 6:case"end":return a.stop()}},a)})),function(){return a.apply(this,arguments)}},W=function(){var a,d=V();return a=(0,b.Z)(c().mark(function a(){var b,e;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,d();case 2:return b=a.sent,e=new G.i(b),a.abrupt("return",e);case 5:case"end":return a.stop()}},a)})),function(){return a.apply(this,arguments)}},X=function(e){var a=(0,s.useState)(),f=a[0],h=a[1],d=(0,s.useState)(!1),g=d[0],i=d[1];return(0,s.useEffect)(function(){(0,b.Z)(c().mark(function a(){var b;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e){a.next=5;break}return a.next=3,O(e);case 3:(b=a.sent)?h(b):i(!0);case 5:case"end":return a.stop()}},a)}))()},[e]),{form:f,formNotFound:g}},Y=function(e,a){var f=a.first,g=a.after,d=(0,s.useState)(),h=d[0],i=d[1],j=T();return(0,s.useEffect)(function(){(0,b.Z)(c().mark(function a(){return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!e){a.next=6;break}return a.t0=i,a.next=4,B({formId:e,first:f,after:g,storyForm:j});case 4:a.t1=a.sent,(0,a.t0)(a.t1);case 6:case"end":return a.stop()}},a)}))()},[g,f,e]),h},Z=function(){var a,d=(0,C.yL)(),e=(0,C.yw)().signTypedDataAsync;return a=(0,b.Z)(c().mark(function a(b){var f,g,h;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return f={domain:y.dL[d.network.name],types:y.Ft,value:b},a.next=3,e(f);case 3:return h={signature:g=a.sent,eip712TypedMessage:f},a.next=7,u.post("/forms",h);case 7:case"end":return a.stop()}},a)})),function(b){return a.apply(this,arguments)}},$=function(d){var a=(0,s.useState)(),e=a[0],f=a[1];return(0,s.useEffect)(function(){(0,b.Z)(c().mark(function a(){return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!d){a.next=6;break}return a.t0=f,a.next=4,P(d);case 4:a.t1=a.sent,(0,a.t0)(a.t1);case 6:case"end":return a.stop()}},a)}))()},[d]),e},_=function(a){return new Promise(function(b){return setTimeout(b,a)})},aa=function(){var e,a=(0,s.useState)(!1),f=a[0],i=a[1],d=(0,s.useState)(!1),g=d[0],j=d[1],h=(e=(0,b.Z)(c().mark(function a(b){return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i(!0),a.next=3,_(3e3);case 3:i(!1),j(!0);case 5:case"end":return a.stop()}},a)})),function(a){return e.apply(this,arguments)});return{submittingForm:f,submitForm:h,submissionComplete:g}},ab=function(){var b=arguments.length>0&& void 0!==arguments[0]?arguments[0]:{first:10,after:""},a=(0,s.useState)(b),c=a[0],d=a[1];return{pagination:c,setPagination:d}},ac=function(){var d,a=(0,s.useState)(!1),e=a[0],g=a[1],h=V(),f=(d=(0,b.Z)(c().mark(function a(b,d){var e,f,i,j,k,l,m,n,o;return c().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return g(!0),a.next=3,h();case 3:return e=a.sent,f=new G.i(e.toString()),i=BigInt(1),j="0",a.next=9,S(f,d,i,j,{wasmFilePath:"/semaphore.wasm",zkeyFilePath:"/semaphore.zkey"});case 9:return k=a.sent,l=BigInt(e),m=BigInt("0x".concat(b.slice(2))),n=(0,F.poseidon)([l,m]),a.next=15,R({secret:l,formId:m,submissionId:n});case 15:return o=a.sent,g(!1),a.abrupt("return",{submissionId:n,dataSubmissionFullProof:o,membershipFullProof:k});case 18:case"end":return a.stop()}},a)})),function(a,b){return d.apply(this,arguments)});return{generatingProof:e,generateProof:f}},ad=function(){var a=(0,C.yL)();return function(b){return"https://".concat(a.network.name,".etherscan.io/search?q=").concat(b)}},ae=function(){var a=(0,C.yL)({});return function(b){return"https://".concat(a.network.name,".etherscan.io/tx/").concat(b,"#eventlog")}}},45682:function(c,a,b){"use strict";b.d(a,{"$":function(){return f},CK:function(){return i},Dw:function(){return d},Gp:function(){return j},HW:function(){return l},Hm:function(){return h},jL:function(){return e},rn:function(){return g}});var d=function(a){return null!=a},e=function(a){return d(a.id)&&d(a.owner)&&d(a.title)&&d(a.unixTime)&&d(a.questions)&&"string"!=typeof a.questions},f=function(a){return d(a.submissionId)&&d(a.formId)&&d(a.unixTime)&&"string"!=typeof a.answers},g=function(a){return"https://viewblock.io/arweave/tx/".concat(a)},h=function(a){return"".concat(a.slice(0,3),"...").concat(a.slice(6,9))},i=function(){return Math.floor(new Date().getTime()/1e3)},j=function(a,b){return a.tags.find(function(a){return b===a.name}).value},k=function(a){return parseInt(j(a,"Unix-Time"))},l=function(a,b){return a.data.transactions.edges.map(function(a){return a.node}).filter(function(a){try{return k(a),!0}catch(b){return!1}}).sort(function(a,b){return k(b)-k(a)}).filter(function(d,a,c){return c.findIndex(function(a){return j(a,b)===j(d,b)})===a})}},46601:function(){},89214:function(){},60299:function(){},27790:function(){},95979:function(){},52361:function(){},94616:function(){},82825:function(){},6567:function(){},87500:function(){}}])